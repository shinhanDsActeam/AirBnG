<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="LockerMapper">

    <select id="findAll" resultType="com.airbng.dto.SampleDTO">
        SELECT * FROM sample_table;
    </select>


    <!-- 인기 보관 5개 지역 -->
    <select id="selectPopularLockers" resultType="com.airbng.dto.PopularLockerDTO$Result">
        SELECT
        l.locker_id,
        l.is_available,
        l.location_id,
        l.member_id,
        COUNT(r.reservation_id) AS reservation_count
        FROM Locker l
        JOIN Member m ON l.member_id = m.member_id
        JOIN Reservation r ON r.keeper_id = m.member_id
        JOIN Location loc ON l.location_id = loc.location_id
        GROUP BY l.locker_id
        ORDER BY reservation_count DESC
        LIMIT 5
    </select>

</mapper>